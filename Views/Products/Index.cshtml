@model IEnumerable<ThetaECommerceApp.Models.Product>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>

            <th class="col-3"></th>
            <th>
                @Html.DisplayNameFor(model => model.Images)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SellerId)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CategoryId)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ShortDescription)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LongDescription)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DeliveryDays)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DeliveryCharges)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Status)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CreatedBy)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CreatedDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ModifiedBy)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ModifiedDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MetaData)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SeoData)
            </th>
            
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
            <tr>
                <td class="col-3">
                <a asp-action="Edit" class="btn btn-warning btn-lg" asp-route-id="@item.Id"><i class="bi bi-pencil"></i> Edit</a> 
                <a asp-action="Details" class="btn btn-info btn-lg" asp-route-id="@item.Id"><i class="bi bi-clipboard-data"></i> Details</a> 
                @*<a asp-action="Delete" class="btn btn-danger btn-lg" asp-route-id="@item.Id"><i class="bi bi-trash"></i> Delete</a>*@

                @if(Context.Session.GetString("UserType") == "1")
                {
                    <a href="#" data-pid="@item.Id" class="deletebutton btn btn-danger btn-lg"><i class="bi bi-trash"></i> Delete</a>
                }
            </td>
                <td>
                    @{
                        string[] sperated = null;
                        if (!string.IsNullOrEmpty(item.Images))
                        {
                            sperated = item.Images.Split(',');

                            if (string.IsNullOrEmpty(sperated[0]))
                            {

                            }
                            else
                            {
                                <img src="@sperated[0]" style="max-height:100px;" class="img-fluid img-thumbnail" />
                            }
                        }
                    }
                </td>
            <td class="pname" data-pid="@item.Id">
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.SellerId)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Images)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Quantity)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CategoryId)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Price)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ShortDescription)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.LongDescription)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DeliveryDays)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DeliveryCharges)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Status)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreatedBy)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreatedDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ModifiedBy)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ModifiedDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MetaData)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.SeoData)
            </td>
            
        </tr>
}
    </tbody>
</table>



@section Scripts{

    <script>
        $(function(){
        
//$('html').hide();





        $('h1').draggable();
        

        $('.pname').hover(function(){
        var pid = $(this).data('pid');
        alert(pid);
        $.ajax({
        
        url: '/products/getquantity',
        type:'get',
        data:{id:pid},
        complete:function(r){
            console.log(r);
                        alert("Product Quantity in the Database is = "+r.responseText);
        if(r.responseText == 1)
        {

        }
        }
        
        
        
        
        
        });
        
        
        
        });



        $('.deletebutton').click(function(){
        
           var pid= $(this).data('pid');
          var Row =  $(this).parent().parent();

           //alert(pid);

                $.ajax({

                    //before:function(){},
                    url: '/products/deleteproduct',
                    type: 'post',
                    data: {
                        id: pid
                    },
                    complete: function (r) {
                        console.log(r);

                        //alert(r.responseText);
                        if (r.responseText == 1) {
                            Row.fadeOut(5000);
                        }
                        else { }

                    },
                    //after:function(){}



                });




        
        });

        
        });
    </script>


}
